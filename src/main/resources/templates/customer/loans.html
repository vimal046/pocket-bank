<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8" />
<title>My Loans - PocketBank</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet" />
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
	rel="stylesheet" />
<style>
body {
	background: #f5f7fa;
	font-family: "Segoe UI";
}

.main-container {
	max-width: 1200px;
	margin: 0 auto;
	padding: 20px;
}

.card {
	border-radius: 12px;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
	margin-bottom: 20px;
}
</style>
</head>
<body>
	<nav class="navbar navbar-expand-lg bg-light">
		<div class="container-fluid main-container">
			<a class="navbar-brand" href=""><i
				class="bi bi-bank2"></i> PocketBank</a>
			<div class="navbar-nav ms-auto">
				<a class="nav-link" href="/customer/dashboard">Dashboard</a>
			</div>
		</div>
	</nav>

	<div class="main-container mt-4">
		<div class="d-flex justify-content-between align-items-center mb-4">
			<h2>
				<i class="bi bi-cash-stack"></i> My Loans
			</h2>
			<button class="btn btn-primary" data-bs-toggle="modal"
				data-bs-target="#applyLoanModal">
				<i class="bi bi-plus-circle"></i> Apply for Loan
			</button>
		</div>

		<div th:if="${success}" class="alert alert-success alert-dismissible">
			<span th:text="${success}"></span>
			<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
		</div>

		<!-- Loans List -->
		<div class="row">
			<div class="col-md-6" th:each="loan : ${loans}">
				<div class="card">
					<div class="card-body">
						<div class="d-flex justify-content-between mb-2">
							<h5>
								<i class="bi bi-currency-rupee"></i> Loan Amount
							</h5>
							<span class="badge"
								th:classappend="${loan.status.name() == 'APPROVED' or loan.status.name() == 'DISBURSED'
      ? 'bg-success'
      : loan.status.name() == 'PENDING'
      ? 'bg-warning'
      : 'bg-danger'}"
								th:text="${loan.status}"> </span>
						</div>
						<h3
							th:text="'₹' + ${#numbers.formatDecimal(loan.loanAmount, 0, 'COMMA', 2, 'POINT')}"></h3>

						<hr />

						<div class="row text-center">
							<div class="col-4">
								<small class="text-muted">Tenure</small>
								<p class="mb-0">
									<strong th:text="${loan.tenureMonths} + ' months'"></strong>
								</p>
							</div>
							<div class="col-4">
								<small class="text-muted">Interest Rate</small>
								<p class="mb-0">
									<strong th:text="${loan.interestRate} + '%'"></strong>
								</p>
							</div>
							<div class="col-4">
								<small class="text-muted">Monthly EMI</small>
								<p class="mb-0">
									<strong
										th:text="'₹' + ${#numbers.formatDecimal(loan.monthlyEmi, 0, 'COMMA', 2, 'POINT')}"></strong>
								</p>
							</div>
						</div>

						<hr />

						<p class="mb-1">
							<strong>Purpose:</strong> <span th:text="${loan.purpose}"></span>
						</p>
						<p class="mb-0">
							<small class="text-muted">Applied on:
								<span
								th:text="${#temporals.format(loan.appliedAt, 'dd-MM-yyyy')}"></span>
							</small>
						</p>
					</div>
				</div>
			</div>
		</div>

		<div th:if="${loans.empty}" class="text-center text-muted py-5">
			<i class="bi bi-inbox" style="font-size: 4rem"></i>
			<p>No loans yet. Apply for a loan to get started!</p>
		</div>
	</div>

	<!-- Apply Loan Modal -->
	<div class="modal fade" id="applyLoanModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Apply for Loan</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<form th:action="@{/customer/loans/apply}" method="post">
					<div class="modal-body">
						<div class="mb-3">
							<label class="form-label">Loan Amount (₹)</label> <input
								type="number" name="loanAmount" class="form-control" min="10000"
								step="1000" required /> <small
								class="text-muted">Minimum: ₹10,000</small>
						</div>

						<div class="mb-3">
							<label class="form-label">Tenure (Months)</label> <select
								name="tenureMonths" class="form-select" required>
								<option value="6">6 Months (8.5% interest)</option>
								<option value="12">12 Months (8.5% interest)</option>
								<option value="24">24 Months (9.0% interest)</option>
								<option value="36">36 Months (9.5% interest)</option>
								<option value="48">48 Months (10.0% interest)</option>
							</select>
						</div>

						<div class="mb-3">
							<label class="form-label">Purpose</label>
							<textarea name="purpose" class="form-control" rows="3"
								placeholder="Describe the purpose of the loan" required></textarea>
						</div>

						<div class="alert alert-info">
							<i class="bi bi-info-circle"></i> Your loan application will be
							reviewed by our admin team.
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary"
							data-bs-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Submit
							Application</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
